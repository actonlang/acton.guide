<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Method Dispatch</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../svgbob.css">
        <link rel="stylesheet" href="../theme/tabs.css">
        <link rel="stylesheet" href=".././mdbook-admonish.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../index.html"><strong aria-hidden="true">1.</strong> Getting started</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../hello.html"><strong aria-hidden="true">1.1.</strong> Hello World</a></li><li class="chapter-item "><a href="../installation.html"><strong aria-hidden="true">1.2.</strong> Installation</a></li><li class="chapter-item "><a href="../hello/shebang.html"><strong aria-hidden="true">1.3.</strong> Acton scripts</a></li><li class="chapter-item "><a href="../projects.html"><strong aria-hidden="true">1.4.</strong> Acton Projects</a></li><li class="chapter-item "><a href="../hello/running_tests.html"><strong aria-hidden="true">1.5.</strong> Running Tests</a></li></ol></li><li class="chapter-item expanded "><a href="../primitives.html"><strong aria-hidden="true">2.</strong> Language</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../primitives.html"><strong aria-hidden="true">2.1.</strong> Variable data types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../primitives/scalars.html"><strong aria-hidden="true">2.1.1.</strong> Scalars</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../primitives/float.html"><strong aria-hidden="true">2.1.1.1.</strong> float</a></li></ol></li><li class="chapter-item "><a href="../primitives/lists.html"><strong aria-hidden="true">2.1.2.</strong> Lists</a></li><li class="chapter-item "><a href="../primitives/dicts.html"><strong aria-hidden="true">2.1.3.</strong> Dictionaries</a></li><li class="chapter-item "><a href="../primitives/tuples.html"><strong aria-hidden="true">2.1.4.</strong> Tuples</a></li><li class="chapter-item "><a href="../primitives/sets.html"><strong aria-hidden="true">2.1.5.</strong> Sets</a></li></ol></li><li class="chapter-item "><a href="../functions.html"><strong aria-hidden="true">2.2.</strong> Functions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../functions/actor_methods.html"><strong aria-hidden="true">2.2.1.</strong> Actor methods</a></li><li class="chapter-item "><a href="../functions/higher_order.html"><strong aria-hidden="true">2.2.2.</strong> Higher order functions</a></li></ol></li><li class="chapter-item "><a href="../types/intro.html"><strong aria-hidden="true">2.3.</strong> Types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../types/explicit.html"><strong aria-hidden="true">2.3.1.</strong> Explicit types</a></li><li class="chapter-item "><a href="../types/generics.html"><strong aria-hidden="true">2.3.2.</strong> Generics</a></li></ol></li><li class="chapter-item "><a href="../classes/intro.html"><strong aria-hidden="true">2.4.</strong> Classes</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../classes/inheritance.html"><strong aria-hidden="true">2.4.1.</strong> Inheritance</a></li></ol></li><li class="chapter-item expanded "><a href="../protocols/intro.html"><strong aria-hidden="true">2.5.</strong> Protocols</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../protocols/dispatch.html" class="active"><strong aria-hidden="true">2.5.1.</strong> Method Dispatch</a></li></ol></li><li class="chapter-item "><a href="../actors.html"><strong aria-hidden="true">2.6.</strong> Actors</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../actors/root.html"><strong aria-hidden="true">2.6.1.</strong> Root Actor</a></li><li class="chapter-item "><a href="../actors/lifetime.html"><strong aria-hidden="true">2.6.2.</strong> Lifetime</a></li><li class="chapter-item "><a href="../actors/attributes.html"><strong aria-hidden="true">2.6.3.</strong> Attributes</a></li><li class="chapter-item "><a href="../actors/concurrency.html"><strong aria-hidden="true">2.6.4.</strong> Concurrency</a></li><li class="chapter-item "><a href="../actors/sync_method_call.html"><strong aria-hidden="true">2.6.5.</strong> Sync Method calls</a></li><li class="chapter-item "><a href="../actors/async_method_call.html"><strong aria-hidden="true">2.6.6.</strong> Async Method calls</a></li><li class="chapter-item "><a href="../actors/cleanup.html"><strong aria-hidden="true">2.6.7.</strong> Cleanup</a></li></ol></li><li class="chapter-item "><a href="../control_flow.html"><strong aria-hidden="true">2.7.</strong> Control flow</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../control_flow/actors.html"><strong aria-hidden="true">2.7.1.</strong> actors</a></li><li class="chapter-item "><a href="../control_flow/if_else.html"><strong aria-hidden="true">2.7.2.</strong> if / elif / else</a></li><li class="chapter-item "><a href="../control_flow/for.html"><strong aria-hidden="true">2.7.3.</strong> for</a></li><li class="chapter-item "><a href="../control_flow/while.html"><strong aria-hidden="true">2.7.4.</strong> while</a></li><li class="chapter-item "><a href="../control_flow/after_sleep.html"><strong aria-hidden="true">2.7.5.</strong> after / sleep</a></li></ol></li><li class="chapter-item "><a href="../security.html"><strong aria-hidden="true">2.8.</strong> Security</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../security/capabilities.html"><strong aria-hidden="true">2.8.1.</strong> Capabilities</a></li></ol></li><li class="chapter-item "><a href="../environment.html"><strong aria-hidden="true">2.9.</strong> Environment</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../environment/variables.html"><strong aria-hidden="true">2.9.1.</strong> Environment variables</a></li><li class="chapter-item "><a href="../environment/stdin.html"><strong aria-hidden="true">2.9.2.</strong> Reading stdin input</a></li><li class="chapter-item "><a href="../environment/interactive_stdin.html"><strong aria-hidden="true">2.9.3.</strong> Interactive stdin input</a></li></ol></li><li class="chapter-item "><a href="../modules.html"><strong aria-hidden="true">2.10.</strong> Modules</a></li></ol></li><li class="chapter-item "><a href="../stdlib.html"><strong aria-hidden="true">3.</strong> Standard library</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../stdlib/re.html"><strong aria-hidden="true">3.1.</strong> Regular Expression</a></li></ol></li><li class="chapter-item "><a href="../testing.html"><strong aria-hidden="true">4.</strong> Testing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../testing/unit_test.html"><strong aria-hidden="true">4.1.</strong> Unit tests</a></li><li class="chapter-item "><a href="../testing/sync_actor_test.html"><strong aria-hidden="true">4.2.</strong> Sync actor tests</a></li><li class="chapter-item "><a href="../testing/async_actor_test.html"><strong aria-hidden="true">4.3.</strong> Async actor tests</a></li><li class="chapter-item "><a href="../testing/env_test.html"><strong aria-hidden="true">4.4.</strong> Env tests</a></li><li class="chapter-item "><a href="../testing/failures_errors.html"><strong aria-hidden="true">4.5.</strong> Failures vs errors</a></li><li class="chapter-item "><a href="../testing/flaky.html"><strong aria-hidden="true">4.6.</strong> Flaky tests</a></li><li class="chapter-item "><a href="../testing/performance.html"><strong aria-hidden="true">4.7.</strong> Performance testing</a></li><li class="chapter-item "><a href="../testing/perf_record.html"><strong aria-hidden="true">4.8.</strong> Perf comparison</a></li></ol></li><li class="chapter-item "><a href="../compilation.html"><strong aria-hidden="true">5.</strong> Build System</a></li><li class="chapter-item "><a href="../package_management.html"><strong aria-hidden="true">6.</strong> Package Management</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../pkg/add_dependency.html"><strong aria-hidden="true">6.1.</strong> Add Dependency</a></li><li class="chapter-item "><a href="../pkg/local_dependencies.html"><strong aria-hidden="true">6.2.</strong> Local Dependencies</a></li><li class="chapter-item "><a href="../pkg/remove_dependency.html"><strong aria-hidden="true">6.3.</strong> Remove Dependency</a></li><li class="chapter-item "><a href="../pkg/fetch_dependencies.html"><strong aria-hidden="true">6.4.</strong> Fetch Deps (Airplane mode)</a></li><li class="chapter-item "><a href="../zig_dependencies.html"><strong aria-hidden="true">6.5.</strong> Zig / C / C++ dependencies</a></li></ol></li><li class="chapter-item "><a href="../security/intro.html"><strong aria-hidden="true">7.</strong> Security and Trust</a></li><li class="chapter-item "><a href="../working_with_zig.html"><strong aria-hidden="true">8.</strong> Working with Zig / C / C++</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ext/integrating_c_library.html"><strong aria-hidden="true">8.1.</strong> Integrating a C library (zlib)</a></li></ol></li><li class="chapter-item "><a href="../rts.html"><strong aria-hidden="true">9.</strong> Run Time System</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="protocol-method-dispatch-and-method-resolution-order"><a class="header" href="#protocol-method-dispatch-and-method-resolution-order">Protocol Method Dispatch and Method Resolution Order</a></h1>
<p>Method dispatch and Method Resolution Order (MRO) is about picking a particular implementation of a method when there are multiple to pick from. For class inheritance, it is pretty straight forward, the method used will always be that of the actual class. For protocols, it is not as simple. Dispatch of methods for protocols is based on the observed type, which can be somewhat surprising.</p>
<p>Here are two classes, the base class <code>Point</code> and the dervied class <code>Point3D</code> (which inherits from <code>Point</code>). Each implement the <code>Eq</code> protocol.</p>
<pre><code class="language-python">class Point(object):
    def __init__(self, x: int, y: int):
        self.x = x
        self.y = y

extension Point (Eq):
    def __eq__(self, other):
        return self.x == other.x and self.y == other.y

class Point3D(Point):
    def __init__(self, x: int, y: int, z: int):
        self.x = x
        self.y = y
        self.z = z

extension Point3D (Eq):
    def __eq__(self, other):
        return self.x == other.x and self.y == other.y and self.z == other.z

def comparator(a: Point, b: Point) -&gt; bool:
    return a == b

actor main(env):
    # p1 and p2 are actually different in z. If seen as a 2D point, they appear
    # equal since the x and y values of p1 and p2 are the same
    p1 = Point3D(1, 2, 3)
    p2 = Point3D(1, 2, 4)

    # False, because we see p1 and p2 as Point3D objects and thus dispatch the Eq
    # extension __eq__ method to Point3D which correctly compares x, y and z
    print(p1 == p2)

    # True, because comparator takes (Point, Point) and thus we see p1 and p2
    # as Point objects and thus dispatch the Eq extension __eq__ method to Point
    # which only compares x and y and thus returns True despite the z difference
    print(comparator(p1, p2))

    env.exit(0)
</code></pre>
<p>The <code>comparator</code> function takes arguments of the base class <code>Point</code> type, which means that when dispatching, they will use the <code>Eq</code> protocol of <code>Point</code> rather than that of <code>Point3D</code>. Naive use typically dispatches to the protocol implementation of the derived class, which is what we intuitively want. It's only when we have forced the type to be observed, as here, that we end up with the "wrong" protocol implementation. Note that there are also cases where this is the desired behavior.</p>
<p>In this particular example, the natural and better solution is to write the comparator function as requiring the Eq type:</p>
<pre><code class="language-python">def generic_comparator[A(Eq)](a: A, b: A):
    return a == b
</code></pre>
<p>Another common scenario is when the type has been forced by storing items in a list or dict, which in turn is typed as storing a base class.</p>
<pre><code class="language-python">actor main(env):
    ref_point = Point3D(1, 2, 4)
    p1 = Point3D(1, 2, 3)
    p2 = Point3D(1, 2, 4)
    my_points: list[Point] = [p1, p2]
    for point in my_points:
        if point == ref_point:
            print("Found the reference (compared as Point)", point)
        if isinstance(point, Point3D) and point == ref_point:
            print("Found the reference (compared to Point3D)", point)
</code></pre>
<p>As shown in the above example, we can force the comparison to use the <code>Eq</code> protocol implemention of <code>Point3D</code> by using <code>isinstance</code> to check and thus coerce the observed type of <code>point</code> to be <code>Point3D</code>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../protocols/intro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../actors.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../protocols/intro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../actors.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../theme/tabs.js"></script>


    </div>
    </body>
</html>
